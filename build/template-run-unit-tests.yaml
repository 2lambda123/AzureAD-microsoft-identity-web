# template-run-unit-tests.yaml
# Run all unit tests across the IdWeb project

steps:

- task: DotNetCoreCLI@2
  inputs:
    command: 'build'
    projects: |
        Tests/**/*.csproj
        !Tests/DevApps/**/*.csproj 
    arguments: '-m'
    continueOnError: 'true'

- task: DotNetCoreCLI@2
  inputs:
    command: 'test'
    projects: |
        Tests/**/*.csproj
        !Tests/DevApps/**/*.csproj 
    arguments: '--nobuild --collect "Code coverage" --settings "build\CodeCoverage.runsettings"'
    continueOnError: 'true'
    
- task: PublishBuildArtifacts@1
  displayName: 'Publish traces after test'
  inputs:
    PathtoPublish: '$(Build.SourcesDirectory)/tests/IntegrationTests/PlaywrightTraces/'
    ArtifactName: 'traces-after-tests-$(Build.BuildNumber)'
  condition: failed()